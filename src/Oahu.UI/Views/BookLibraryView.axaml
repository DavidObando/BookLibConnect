<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Oahu.Core.UI.Avalonia.ViewModels"
             xmlns:conv="using:Oahu.Core.UI.Avalonia.Converters"
             x:Class="Oahu.Core.UI.Avalonia.Views.BookLibraryView"
             x:DataType="vm:BookLibraryViewModel"
             x:CompileBindings="True">

  <DockPanel>
    <!-- Toolbar -->
    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="8">
      <TextBox Watermark="Filter books..."
               Text="{Binding FilterText}"
               Width="250" />
      <Button Content="Select All" Command="{Binding SelectAllCommand}" />
      <Button Content="Deselect All" Command="{Binding DeselectAllCommand}" />
      <Border Width="1" Background="LightGray" Margin="4,2" />
      <Button Content="Queue Selection For Download"
              Command="{Binding DownloadSelectedCommand}"
              Classes="accent" />
      <TextBlock Text="{Binding SelectedCount, StringFormat='{}{0} selected'}"
                 VerticalAlignment="Center" Foreground="Gray" FontSize="12" />
    </StackPanel>

    <!-- Main content: book list + detail panel -->
    <Grid RowDefinitions="3*,Auto,*" Margin="8">

      <!-- Book list -->
      <DataGrid x:Name="booksGrid"
                Grid.Row="0"
                ItemsSource="{Binding Books}"
                SelectedItem="{Binding SelectedBook}"
                AutoGenerateColumns="False"
                CanUserResizeColumns="True"
                CanUserSortColumns="True"
                GridLinesVisibility="Horizontal">
        <DataGrid.Columns>
          <DataGridCheckBoxColumn Header="&#x2713;"
                                  Binding="{Binding IsSelected}"
                                  Width="40" />
          <DataGridTextColumn Header="Title"
                              Binding="{Binding Title}"
                              IsReadOnly="True"
                              Width="*" />
          <DataGridTextColumn Header="Author"
                              Binding="{Binding Author}"
                              IsReadOnly="True"
                              Width="200" />
          <DataGridTextColumn Header="Narrator"
                              Binding="{Binding Narrator}"
                              IsReadOnly="True"
                              Width="150" />
          <DataGridTemplateColumn Header="Duration"
                                  SortMemberPath="RunTimeLengthSeconds"
                                  Width="80">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate x:DataType="vm:BookItemViewModel">
                <TextBlock Text="{Binding Duration}"
                           VerticalAlignment="Center"
                           Margin="4,0" />
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>
          <DataGridTextColumn Header="Purchased"
                              Binding="{Binding PurchaseDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                              IsReadOnly="True"
                              Width="100" />
          <DataGridTextColumn Header="State"
                              Binding="{Binding ConversionState}"
                              IsReadOnly="True"
                              Width="100" />
        </DataGrid.Columns>
      </DataGrid>

      <!-- Splitter -->
      <GridSplitter Grid.Row="1" Height="6"
                    HorizontalAlignment="Stretch"
                    Background="Transparent" />

      <!-- Detail panel -->
      <Border Grid.Row="2"
              BorderBrush="LightGray" BorderThickness="0,1,0,0"
              IsVisible="{Binding HasSelectedBook}">
        <Grid ColumnDefinitions="Auto,*,Auto" Margin="8">

          <!-- Properties grid -->
          <Grid Grid.Column="0"
                ColumnDefinitions="Auto,8,Auto"
                RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                VerticalAlignment="Top">

            <TextBlock Grid.Row="0" Grid.Column="0" Text="State" FontWeight="SemiBold" />
            <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding SelectedBook.ConversionStateText}" />

            <TextBlock Grid.Row="1" Grid.Column="0" Text="Title" FontWeight="SemiBold" />
            <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding SelectedBook.Title}" TextWrapping="Wrap" MaxWidth="350" />

            <TextBlock Grid.Row="2" Grid.Column="0" Text="Author" FontWeight="SemiBold" />
            <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding SelectedBook.Author}" />

            <TextBlock Grid.Row="3" Grid.Column="0" Text="Duration" FontWeight="SemiBold" />
            <TextBlock Grid.Row="3" Grid.Column="2" Text="{Binding SelectedBook.Duration}" />

            <TextBlock Grid.Row="4" Grid.Column="0" Text="Unabridged" FontWeight="SemiBold" />
            <TextBlock Grid.Row="4" Grid.Column="2" Text="{Binding SelectedBook.Unabridged}" />

            <TextBlock Grid.Row="5" Grid.Column="0" Text="Language" FontWeight="SemiBold" />
            <TextBlock Grid.Row="5" Grid.Column="2" Text="{Binding SelectedBook.Language}" />

            <TextBlock Grid.Row="6" Grid.Column="0" Text="Release Date" FontWeight="SemiBold" />
            <TextBlock Grid.Row="6" Grid.Column="2" Text="{Binding SelectedBook.ReleaseDate, StringFormat='{}{0:yyyy-MM-dd}'}" />

            <TextBlock Grid.Row="7" Grid.Column="0" Text="Narrator" FontWeight="SemiBold" />
            <TextBlock Grid.Row="7" Grid.Column="2" Text="{Binding SelectedBook.Narrator}" />

            <TextBlock Grid.Row="8" Grid.Column="0" Text="Publisher" FontWeight="SemiBold" />
            <TextBlock Grid.Row="8" Grid.Column="2" Text="{Binding SelectedBook.Publisher}" />

            <TextBlock Grid.Row="9" Grid.Column="0" Text="Series" FontWeight="SemiBold" />
            <TextBlock Grid.Row="9" Grid.Column="2" Text="{Binding SelectedBook.Series}" />

            <TextBlock Grid.Row="10" Grid.Column="0" Text="Parts" FontWeight="SemiBold" />
            <TextBlock Grid.Row="10" Grid.Column="2" Text="{Binding SelectedBook.Parts}" />

            <TextBlock Grid.Row="11" Grid.Column="0" Text="Purchased" FontWeight="SemiBold" />
            <TextBlock Grid.Row="11" Grid.Column="2" Text="{Binding SelectedBook.PurchaseDate, StringFormat='{}{0:yyyy-MM-dd}'}" />
          </Grid>

          <!-- Description -->
          <ScrollViewer Grid.Column="1" Margin="16,0"
                        VerticalScrollBarVisibility="Auto">
            <TextBlock Text="{Binding SelectedBook.Description}"
                       TextWrapping="Wrap"
                       FontSize="12"
                       Foreground="Gray" />
          </ScrollViewer>

          <!-- Cover image -->
          <Image Grid.Column="2"
                 Source="{Binding SelectedBook.CoverImagePath, Converter={x:Static conv:FilePathToImageConverter.Instance}}"
                 MaxWidth="150" MaxHeight="150"
                 Stretch="Uniform"
                 VerticalAlignment="Top"
                 Margin="0,0,4,0" />

        </Grid>
      </Border>

    </Grid>
  </DockPanel>

</UserControl>
